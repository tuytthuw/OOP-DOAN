# Kế Hoạch Kỹ Thuật #0007 - Xây Dựng Collection Manager

## 1. Mô Tả Ngữ Cảnh

Tạo các lớp quản lý tập hợp dữ liệu (Collection Manager) để lưu trữ và quản lý các danh sách khách hàng, dịch vụ, lịch hẹn, giao dịch, chiết khấu và hóa đơn.

---

## 2. Các Tệp và Hàm Liên Quan

### Tệp TẠO MỚI:

- `src/main/java/collections/CustomerManager.java` - Quản lý danh sách khách hàng
- `src/main/java/collections/ServiceManager.java` - Quản lý danh sách dịch vụ
- `src/main/java/collections/AppointmentManager.java` - Quản lý danh sách lịch hẹn
- `src/main/java/collections/TransactionManager.java` - Quản lý danh sách giao dịch
- `src/main/java/collections/DiscountManager.java` - Quản lý danh sách chiết khấu
- `src/main/java/collections/InvoiceManager.java` - Quản lý danh sách hóa đơn

### Tệp THAY ĐỔI:

- `src/main/java/collections/Init.java` - Thêm khởi tạo tất cả managers

---

## 3. Thuật Toán / Logic (Từng Bước)

### 3.1 Cấu Trúc Chung Các Manager

Mỗi Manager sẽ có cấu trúc tương tự:

```
[Entity]Manager
├── Thuộc tính (Attributes):
│   └── items: List<[Entity]> (Danh sách lưu trữ các đối tượng)
│
├── Phương Thức Chung (Common Methods):
│   ├── add([Entity]): boolean (Thêm item mới)
│   ├── update([Entity]): boolean (Cập nhật item)
│   ├── delete(id): boolean (Xóa item)
│   ├── getById(id): [Entity] (Tìm item theo ID)
│   ├── getAll(): List<[Entity]> (Lấy tất cả items)
│   ├── size(): int (Số lượng items)
│   ├── clear(): void (Xóa tất cả)
│   └── exists(id): boolean (Kiểm tra item có tồn tại)
│
└── Phương Thức Tìm Kiếm Cụ Thể (Entity-specific Methods)
```

### 3.2 CustomerManager - Quản Lý Khách Hàng

**Phương thức bổ sung:**

- `findByPhone(phoneNumber): Customer` - Tìm khách hàng theo số điện thoại
- `findByEmail(email): Customer` - Tìm khách hàng theo email
- `findByTier(tier): List<Customer>` - Tìm tất cả khách hàng thuộc tier nào đó
- `findActiveCustomers(): List<Customer>` - Lấy tất cả khách hàng hoạt động
- `getTopSpenders(limit): List<Customer>` - Lấy top N khách hàng chi tiêu nhiều nhất

### 3.3 ServiceManager - Quản Lý Dịch Vụ

**Phương thức bổ sung:**

- `findByCategory(category): List<Service>` - Tìm dịch vụ theo loại
- `findByName(name): List<Service>` - Tìm dịch vụ theo tên (chứa chuỗi)
- `findActiveServices(): List<Service>` - Lấy tất cả dịch vụ hoạt động
- `findByPriceRange(minPrice, maxPrice): List<Service>` - Tìm dịch vụ trong khoảng giá
- `getServicesByDuration(duration): List<Service>` - Tìm dịch vụ theo khoảng thời gian

### 3.4 AppointmentManager - Quản Lý Lịch Hẹn

**Phương thức bổ sung:**

- `findByCustomerId(customerId): List<Appointment>` - Tìm lịch hẹn của khách hàng
- `findByServiceId(serviceId): List<Appointment>` - Tìm lịch hẹn dịch vụ nào
- `findByStatus(status): List<Appointment>` - Tìm lịch hẹn theo trạng thái
- `findByDateRange(startDate, endDate): List<Appointment>` - Tìm lịch hẹn trong khoảng ngày
- `findUpcomingAppointments(): List<Appointment>` - Lấy lịch hẹn sắp tới (SCHEDULED)
- `getExpiredAppointments(): List<Appointment>` - Lấy lịch hẹn quá hạn

### 3.5 TransactionManager - Quản Lý Giao Dịch

**Phương thức bổ sung:**

- `findByCustomerId(customerId): List<Transaction>` - Tìm giao dịch của khách hàng
- `findByStatus(status): List<Transaction>` - Tìm giao dịch theo trạng thái
- `findByPaymentMethod(method): List<Transaction>` - Tìm giao dịch theo phương thức thanh toán
- `findByDateRange(startDate, endDate): List<Transaction>` - Tìm giao dịch trong khoảng ngày
- `getTotalRevenue(startDate, endDate): BigDecimal` - Tính tổng doanh thu

### 3.6 DiscountManager - Quản Lý Chiết Khấu

**Phương thức bổ sung:**

- `findByCode(discountCode): Discount` - Tìm chiết khấu theo mã
- `findActiveDiscounts(): List<Discount>` - Lấy tất cả chiết khấu hoạt động
- `findByType(type): List<Discount>` - Tìm chiết khấu theo loại
- `findValidDiscounts(date): List<Discount>` - Lấy chiết khấu hợp lệ cho ngày nào đó
- `findDiscountsByCodePattern(pattern): List<Discount>` - Tìm chiết khấu theo pattern mã

### 3.7 InvoiceManager - Quản Lý Hóa Đơn

**Phương thức bổ sung:**

- `findByCustomerId(customerId): List<Invoice>` - Tìm hóa đơn của khách hàng
- `findByAppointmentId(appointmentId): Invoice` - Tìm hóa đơn của lịch hẹn
- `findByPaymentStatus(isPaid): List<Invoice>` - Tìm hóa đơn theo trạng thái thanh toán
- `findByDateRange(startDate, endDate): List<Invoice>` - Tìm hóa đơn trong khoảng ngày
- `getTotalRevenue(startDate, endDate): BigDecimal` - Tính tổng doanh thu từ hóa đơn

---

## 4. Logic Cấp Cao

### 4.1 Logic Thêm Item

**Bước thực hiện `add([Entity])`:**

1. Kiểm tra item không null
2. Kiểm tra ID không trùng lặp (gọi `exists(id)`)
3. Nếu trùng: trả về false
4. Thêm item vào danh sách: `items.add([Entity])`
5. Trả về true

### 4.2 Logic Cập Nhật Item

**Bước thực hiện `update([Entity])`:**

1. Kiểm tra item không null
2. Tìm item với ID tương ứng
3. Nếu không tìm thấy: trả về false
4. Thay thế item cũ bằng item mới
5. Trả về true

### 4.3 Logic Xóa Item

**Bước thực hiện `delete(id)`:**

1. Tìm item theo ID
2. Nếu không tìm thấy: trả về false
3. Xóa item khỏi danh sách: `items.remove([Entity])`
4. Trả về true

---

## 5. Ghi Chú Kỹ Thuật

- Sử dụng `ArrayList<T>` để lưu trữ dữ liệu
- Các phương thức tìm kiếm nên trả về `null` hoặc `Collections.emptyList()` nếu không tìm thấy
- Phương thức `size()` trả về `items.size()`
- Phương thức `getAll()` nên trả về bản copy của danh sách để tránh thay đổi từ bên ngoài
- Cần kiểm tra tính hợp lệ của dữ liệu trước khi thêm/cập nhật
- Comment bằng tiếng Việt cho Javadoc và logic phức tạp
