# Kế Hoạch Kỹ Thuật #0003 - Xây Dựng Model Lịch Hẹn (Appointment Model)

## 1. Mô Tả Ngữ Cảnh

Tạo lớp `Appointment` để quản lý lịch hẹn dịch vụ. Lớp này kết nối khách hàng, dịch vụ, thời gian và trạng thái lịch hẹn.

---

## 2. Các Tệp và Hàm Liên Quan

### Tệp TẠO MỚI:

- `src/main/java/models/Appointment.java` - Lớp chính đại diện cho lịch hẹn

### Tệp THAY ĐỔI:

- `src/main/java/models/Init.java` - Thêm khởi tạo dữ liệu Sample
- `src/main/java/enums/AppointmentStatus.java` - Enum đã tồn tại, sử dụng lại

---

## 3. Thuật Toán / Logic (Từng Bước)

### 3.1 Cấu Trúc Lớp Appointment

```
Appointment implements IEntity
├── Thuộc tính (Attributes):
│   ├── appointmentId: String (ID duy nhất, định dạng: APT_XXXXX)
│   ├── customerId: String (ID khách hàng)
│   ├── serviceId: String (ID dịch vụ)
│   ├── appointmentDateTime: LocalDateTime (Ngày giờ hẹn)
│   ├── status: AppointmentStatus (Trạng thái: SCHEDULED, SPENDING, COMPLETED, CANCELLED)
│   ├── staffId: String (ID nhân viên thực hiện, có thể null)
│   ├── notes: String (Ghi chú bổ sung)
│   ├── createdDate: LocalDateTime (Ngày tạo lịch hẹn)
│   └── completedDate: LocalDateTime (Ngày hoàn thành, có thể null)
│
├── Phương Thức (Methods):
│   ├── Constructor(appointmentId, customerId, serviceId, appointmentDateTime)
│   ├── updateStatus(newStatus): void (Cập nhật trạng thái)
│   ├── assignStaff(staffId): void (Gán nhân viên cho lịch hẹn)
│   ├── markAsCompleted(): void (Đánh dấu hoàn thành - cập nhật status và completedDate)
│   ├── markAsCancelled(): void (Đánh dấu hủy bỏ)
│   ├── isExpired(): boolean (Kiểm tra lịch hẹn có hết hạn chưa)
│   ├── Getter/Setter cho tất cả thuộc tính
│   ├── equals() & hashCode() (So sánh dựa trên appointmentId)
│   └── display(), input(), getId(), getPrefix() - kế thừa từ IEntity
```

### 3.2 Logic Chuyển Đổi Trạng Thái

**Trạng thái và quy tắc chuyển đổi:**

```
SCHEDULED (Đã lên lịch)
    ↓ (Khi bắt đầu dịch vụ)
SPENDING (Đang thực hiện)
    ├→ COMPLETED (Hoàn thành)
    └→ CANCELLED (Hủy bỏ)
CANCELLED ↔ SCHEDULED (Có thể hủy hoặc sắp xếp lại trước khi thực hiện)
```

**Bước thực hiện `updateStatus(newStatus)`:**

1. Kiểm tra trạng thái hiện tại có hợp lệ không
2. Kiểm tra chuyển đổi từ trạng thái cũ sang trạng thái mới có hợp pháp không
3. Cập nhật status
4. Nếu chuyển sang COMPLETED: gọi `setCompletedDate(LocalDateTime.now())`
5. Trả về true/false tùy theo kết quả

### 3.3 Logic Hoàn Thành Lịch Hẹn

**Bước thực hiện `markAsCompleted()`:**

1. Kiểm tra status hiện tại có phải SPENDING không
2. Cập nhật status thành COMPLETED
3. Ghi nhận thời gian hoàn thành (`completedDate = LocalDateTime.now()`)
4. Trả về thông báo thành công

### 3.4 Logic Kiểm Tra Hết Hạn

**Bước thực hiện `isExpired()`:**

1. Lấy thời gian hiện tại: `LocalDateTime.now()`
2. Kiểm tra nếu `appointmentDateTime` < thời gian hiện tại
3. Kiểm tra nếu status vẫn là SCHEDULED
4. Trả về true nếu quá hạn, false nếu không

---

## 4. Ghi Chú Kỹ Thuật

- Sử dụng `LocalDateTime` để quản lý ngày giờ chính xác
- Các trường `staffId` và `completedDate` có thể null ban đầu
- Phương thức `isExpired()` sẽ được sử dụng để xác định lịch hẹn nào cần được cảnh báo
- ID lịch hẹn nên được sinh tự động hoặc được cung cấp khi tạo
- Sử dụng Enum `AppointmentStatus` đã được định nghĩa
- Comment bằng tiếng Việt cho Javadoc và logic phức tạp
