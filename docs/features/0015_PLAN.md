# Kế Hoạch Kỹ Thuật #0015 - Mô hình Sản phẩm (Product Model)

## 1. Mô Tả Ngữ Cảnh

Tạo lớp `Product` để đại diện cho các sản phẩm bán lẻ tại spa (ví dụ: mỹ phẩm, dầu gội, dụng cụ chăm sóc). Lớp này sẽ quản lý thông tin chi tiết, giá cả, và quan trọng nhất là số lượng tồn kho. `Product` sẽ là một đối tượng có thể bán được (`Sellable`), cho phép nó được thêm vào hóa đơn cùng với các dịch vụ.

---

## 2. Các Tệp và Hàm Liên Quan

### Tệp TẠO MỚI:

- `src/main/java/models/Product.java` - Lớp thực thể cho sản phẩm.
- `src/main/java/collections/ProductManager.java` - Lớp quản lý danh sách sản phẩm.

### Tệp THAY ĐỔI:

- `src/main/java/models/Init.java` - Bổ sung dữ liệu mẫu cho sản phẩm.
- `src/main/java/interfaces/Sellable.java` - Đảm bảo `Product` có thể implement interface này.
- `src/main/java/ui/ProductMenu.java` - (Tùy chọn) Tạo menu con để quản lý sản phẩm.

---

## 3. Thuật Toán / Logic (Từng Bước)

### 3.1 Cấu Trúc Lớp `Product`

Lớp `Product` sẽ implement cả `IEntity` và `Sellable`.

```java
public class Product implements IEntity, Sellable {
    // Thuộc tính
    private String productId;       // ID duy nhất, định dạng: PROD_XXXXX
    private String productName;     // Tên sản phẩm
    private String brand;           // Thương hiệu
    private String description;     // Mô tả sản phẩm
    private BigDecimal basePrice;     // Giá bán
    private int stockQuantity;      // Số lượng tồn kho
    private boolean isActive;         // Trạng thái kinh doanh

    // Constructor, Getters, Setters

    // Phương thức quản lý kho
    public void increaseStock(int quantity);
    public void decreaseStock(int quantity) throws BusinessLogicException;

    // Ghi đè phương thức từ IEntity
    @Override
    public String getId();

    // Ghi đè phương thức từ Sellable
    @Override
    public BigDecimal getPrice();

    @Override
    public String getDescription();

    @Override
    public boolean isAvailable();
}
```

### 3.2 Logic Các Phương Thức Chính Của `Product`

#### `increaseStock(int quantity)`
1.  Kiểm tra `quantity` phải là số dương.
2.  Cộng `quantity` vào `this.stockQuantity`.

#### `decreaseStock(int quantity)`
1.  Kiểm tra `quantity` phải là số dương.
2.  Kiểm tra nếu `quantity > this.stockQuantity`, `throw new BusinessLogicException("Không đủ hàng trong kho.")`.
3.  Trừ `quantity` khỏi `this.stockQuantity`.

#### `isAvailable()` (Từ Interface `Sellable`)
1.  Trả về kết quả của `this.isActive && this.stockQuantity > 0`.

### 3.3 Cấu Trúc Lớp `ProductManager`

Lớp này sẽ kế thừa từ `BaseManager<Product>` để có sẵn các chức năng CRUD.

```java
public class ProductManager extends BaseManager<Product> {

    /**
     * Tìm các sản phẩm đã hết hàng.
     * @return Mảng các sản phẩm có stockQuantity = 0.
     */
    public Product[] findOutOfStockProducts();

    /**
     * Tìm sản phẩm theo tên (chứa chuỗi tìm kiếm).
     * @param name Tên sản phẩm cần tìm.
     * @return Mảng các sản phẩm phù hợp.
     */
    public Product[] findByName(String name);
}
```

### 3.4 Logic Các Phương Thức Của `ProductManager`

#### `findOutOfStockProducts()`
1.  Lấy tất cả sản phẩm từ `super.getAll()`.
2.  Duyệt qua mảng, lọc ra các sản phẩm có `getStockQuantity() == 0`.
3.  Trả về một mảng mới chứa các sản phẩm đã lọc.

#### `findByName(String name)`
1.  Lấy tất cả sản phẩm từ `super.getAll()`.
2.  Duyệt qua mảng, lọc ra các sản phẩm có `getProductName()` chứa chuỗi `name` (không phân biệt chữ hoa/thường).
3.  Trả về một mảng mới chứa các sản phẩm đã lọc.

---

## 4. Ghi Chú Kỹ Thuật

- **`Sellable`:** `Product` là một `Sellable`, cho phép nó được xử lý chung với `Service` trong các nghiệp vụ như tạo hóa đơn, thanh toán.
- **Quản lý kho:** Logic tăng/giảm tồn kho phải được kiểm soát chặt chẽ để đảm bảo dữ liệu luôn chính xác. Việc giảm tồn kho chỉ nên xảy ra khi một hóa đơn được xác nhận thanh toán.
- **Validation:** Cần có validation cho giá (`basePrice` không âm) và số lượng (`stockQuantity` không âm).
- **ID:** `productId` nên được sinh tự động theo định dạng `PROD_XXXXX` để đảm bảo tính duy nhất.
