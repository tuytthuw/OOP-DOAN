# Kế Hoạch Kỹ Thuật #0009 - Xây Dựng Input/Output Manager

## ⚠️ TUÂN THỨ: Dùng Mảng T[], Không dùng List/ArrayList

## 1. Mô Tả Ngữ Cảnh

Tạo các lớp IO Manager để xử lý input từ người dùng và output dữ liệu ra console. Cung cấp các phương thức tiện ích để đọc dữ liệu từ bàn phím và hiển thị thông tin.

**Nguyên tắc:**

- InputHandler: Đọc dữ liệu, throw ValidationException nếu lỗi
- OutputFormatter: Hiển thị mảy T[], không dùng java.util.List

---

## 2. Các Tệp và Hàm Liên Quan

### Tệp TẠO MỚI:

- `src/main/java/io/InputHandler.java` - Xử lý input từ người dùng
- `src/main/java/io/OutputFormatter.java` - Định dạng và hiển thị output
- `src/main/java/io/FileHandler.java` - Xử lý lưu/tải dữ liệu từ file (tùy chọn)

### Tệp THAY ĐỔI:

- `src/main/java/io/Init.java` - Thêm khởi tạo các IO handlers

---

## 3. Thuật Toán / Logic (Từng Bước)

### 3.1 InputHandler - Xử Lý Input

**Phương thức:**

- `readString(prompt): String` - Đọc chuỗi từ người dùng
- `readInt(prompt): int` - Đọc số nguyên
- `readDouble(prompt): double` - Đọc số thực
- `readBigDecimal(prompt): BigDecimal` - Đọc số tiền
- `readLocalDate(prompt): LocalDate` - Đọc ngày (định dạng dd/MM/yyyy)
- `readLocalDateTime(prompt): LocalDateTime` - Đọc ngày giờ
- `readBoolean(prompt): boolean` - Đọc yes/no
- `readOption(options): String` - Đọc lựa chọn từ danh sách
- `readEmail(prompt): String` - Đọc email và validate
- `readPhoneNumber(prompt): String` - Đọc số điện thoại

**Logic `readInt(prompt)`:**

1. Hiển thị prompt cho người dùng
2. Đọc input từ bàn phím
3. Kiểm tra input có phải số nguyên không
4. Nếu không: hiển thị lỗi, yêu cầu nhập lại
5. Trả về số nguyên

**Logic `readLocalDate(prompt)`:**

1. Hiển thị prompt cho người dùng (định dạng: dd/MM/yyyy)
2. Đọc input từ bàn phím
3. Kiểm tra format có đúng không
4. Parse thành LocalDate
5. Nếu lỗi: hiển thị lỗi, yêu cầu nhập lại
6. Trả về LocalDate

**Logic `readEmail(prompt)`:**

1. Hiển thị prompt cho người dùng
2. Đọc input từ bàn phím
3. Validate email theo regex: `^[A-Za-z0-9+_.-]+@[A-Za-z0-9.-]+$`
4. Nếu không hợp lệ: hiển thị lỗi, yêu cầu nhập lại
5. Trả về email

**Logic `readOption(options)`:**

1. Hiển thị danh sách lựa chọn với số thứ tự
2. Yêu cầu nhập số tương ứng
3. Validate số có nằm trong khoảng [1, options.size()] không
4. Trả về lựa chọn được chọn

---

### 3.2 OutputFormatter - Định Dạng Output

**Phương thức:**

- `printHeader(title): void` - In tiêu đề
- `printSeparator(): void` - In đường phân cách
- `printTable(headers, rows): void` - In bảng
- `printCustomerInfo(customer): void` - In thông tin khách hàng
- `printServiceInfo(service): void` - In thông tin dịch vụ
- `printAppointmentInfo(appointment): void` - In thông tin lịch hẹn
- `printInvoiceInfo(invoice): void` - In thông tin hóa đơn
- `printTransactionInfo(transaction): void` - In thông tin giao dịch
- `printSuccess(message): void` - In thông báo thành công
- `printError(message): void` - In thông báo lỗi
- `printWarning(message): void` - In cảnh báo
- `printList(items, itemFormatter): void` - In danh sách các items

**Logic `printTable(headers, rows)`:**

1. Tính độ rộng cột (dựa trên header và dữ liệu)
2. In hàng header với định dạng cột đồng nhất
3. In đường phân cách
4. Lặp qua từng hàng dữ liệu, in theo định dạng cột
5. In đường phân cách cuối cùng

**Ví dụ:**

```
┌─────────────┬──────────────────────┬──────────────┐
│ ID          │ Tên                  │ Số Điện Thoại│
├─────────────┼──────────────────────┼──────────────┤
│ CUST_001    │ Nguyễn Văn A         │ 0912345678   │
│ CUST_002    │ Trần Thị B           │ 0987654321   │
└─────────────┴──────────────────────┴──────────────┘
```

**Logic `printInvoiceInfo(invoice)`:**

1. In tiêu đề: "========== HÓA ĐƠN =========="
2. In thông tin cơ bản: ID, Ngày, Khách hàng
3. In đường phân cách
4. In chi tiết tiền:
   - Subtotal
   - Chiết khấu (nếu có)
   - Thuế
   - Tổng cộng
5. In trạng thái thanh toán
6. In đường phân cách

---

### 3.3 FileHandler - Xử Lý File (Tùy Chọn)

**Phương thức:**

- `loadDataFromFile(filename): Map<String, List<Object>>` - Tải dữ liệu từ file
- `saveDataToFile(filename, data): void` - Lưu dữ liệu vào file
- `exportInvoiceToCSV(invoices, filename): void` - Export hóa đơn ra CSV
- `generateReport(filename, data): void` - Tạo báo cáo

**Format file dữ liệu:**

- Sử dụng JSON hoặc CSV để lưu dữ liệu
- Nên có backup tự động

---

## 4. Compliance & Ghi Chú Kỹ Thuật

### ❌ KHÔNG DÙNG:

```java
import java.util.List;
import java.util.Map;
List<Customer> customers = new ArrayList<>();
```

### ✅ PHẢI DÙNG:

```java
// OutputFormatter nhận mảy từ Service/Manager
public void displayCustomers(Customer[] customers) {
    for (Customer c : customers) {
        System.out.println(c);
    }
}

// Nếu cần lưu kết quả tạm thời, dùng mảy
Object[] tempResults = new Object[10];
int count = 0;
```

### Quy tắc IO Layer:

1. **InputHandler**:

   - Dùng Scanner để đọc từ console (✅ OK)
   - Throw ValidationException nếu input không hợp lệ
   - Cho phép retry 3 lần

2. **OutputFormatter**:

   - Nhận mảy T[] từ Services
   - Định dạng đẹp mắt, dễ đọc
   - Không lưu trữ dữ liệu

3. **FileHandler** (tùy chọn):
   - Dùng JSON hoặc CSV
   - Không dùng Serialization (để đơn giản)

### Hằng Số Cần Định Nghĩa:

```java
DEFAULT_DATE_FORMAT = "dd/MM/yyyy"
DEFAULT_DATETIME_FORMAT = "dd/MM/yyyy HH:mm"
DEFAULT_COLUMN_WIDTH = 20
EMAIL_PATTERN = "^[A-Za-z0-9+_.-]+@[A-Za-z0-9.-]+$"
PHONE_PATTERN = "^(0|\\+84)[0-9]{9,10}$"
```

---

## 5. Tệp Cần Tạo / Thay Đổi

### ✅ Tệp TẠO MỚI:

- `src/main/java/io/InputHandler.java`
- `src/main/java/io/OutputFormatter.java`
- `src/main/java/io/FileHandler.java` (tùy chọn)

### ✅ Tệp THAY ĐỔI:

- `src/main/java/io/Init.java` - Thêm khởi tạo IO handlers
- Sử dụng `System.in` để đọc input từ bàn phím
- Sử dụng `System.out.println()` để in ra console
- Có thể sử dụng ANSI color codes để tô màu output (tùy chọn)
- Comment bằng tiếng Việt cho Javadoc và logic phức tạp
